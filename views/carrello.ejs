<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>Carrello - ComixCity</title>
    <link rel="stylesheet" href="/css/stile.css" />
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
  </head>

  <body>
    <%- include('partials/navbar1') %>

    <section class="background-gradient">
      <!-- HERO CARRELLO -->
      <section class="hero2 carrello-hero">
        <div class="hero-content-chisiamo">
          <h1 data-aos="fade-up">Il Tuo Carrello</h1>
          <h2 data-aos="fade-up" data-aos-delay="300">
            Controlla i tuoi biglietti e preparati all'avventura!
          </h2>
        </div>
      </section>

      <!-- SEZIONE CARRELLO -->
      <section class="carrello-main">
        <div class="carrello-container" data-aos="fade-up">
          <h2 data-aos="fade-up">Riepilogo Acquisti</h2>

          <% if (query && query.success==='1' ) { %>
          <p class="successo" data-aos="fade-down">
            ‚úÖ Acquisto completato con successo!
          </p>
          <% } else if (query && query.rimosso==='ok' ) { %>
          <p class="successo" data-aos="fade-down">
            ‚úÖ Biglietto rimosso dal carrello!
          </p>
          <% } else if (query && query.svuotato==='ok' ) { %>
          <p class="successo" data-aos="fade-down">üßπ Carrello svuotato!</p>
          <% } else if (query && query.errore==='carrello_vuoto' ) { %>
          <p class="errore" data-aos="fade-down">‚ùå Il carrello √® vuoto!</p>
          <% } else if (query && query.errore==='totale_invalido' ) { %>
          <p class="errore" data-aos="fade-down">
            ‚ùå Errore nel calcolo del totale!
          </p>
          <% } else if (query && query.errore==='biglietto_non_trovato' ) { %>
          <p class="errore" data-aos="fade-down">‚ùå Biglietto non trovato!</p>
          <% } else if (query && query.errore==='disponibilita_insufficiente' )
          { %>
          <p class="errore" data-aos="fade-down">
            ‚ùå Disponibilit√† insufficiente!
          </p>
          <% } else if (query && query.errore==='prezzo_manomesso' ) { %>
          <p class="errore" data-aos="fade-down">
            ‚ùå Prezzo manomesso, transazione annullata.
          </p>
          <% } %>

          <table
            class="carrello-tabella"
            data-aos="fade-up"
            data-aos-delay="200"
          >
            <thead>
              <tr>
                <th>Biglietto</th>
                <th>Quantit√†</th>
                <th>Prezzo</th>
                <th>Totale</th>
                <th>Azioni</th>
              </tr>
            </thead>
            <tbody>
              <% if (carrello.length===0) { %>
              <tr>
                <td colspan="5" class="carrello-vuoto">Il carrello √® vuoto.</td>
              </tr>
              <% } else { %> <% carrello.forEach((item,index)=> { %>
              <tr>
                <td><%= item.nome %></td>
                <td>
                  <form
                    action="/carrello/decrementa/<%= index %>"
                    method="POST"
                    class="inline"
                  >
                    <button type="submit" class="btn-sm btn-decrementa">
                      -
                    </button>
                  </form>

                  <span class="quantita"> <%= item.quantita %> </span>

                  <form
                    action="/carrello/incrementa/<%= index %>"
                    method="POST"
                    class="inline"
                  >
                    <button type="submit" class="btn-sm btn-incrementa">
                      +
                    </button>
                  </form>
                </td>
                <td>‚Ç¨<%= item.prezzo.toFixed(2) %></td>
                <td>‚Ç¨<%= (item.quantita * item.prezzo).toFixed(2) %></td>
                <td>
                  <form action="/carrello/rimuovi/<%= index %>" method="POST">
                    <button type="submit" class="btn btn-secondary ml-1">
                      Rimuovi
                    </button>
                  </form>
                </td>
              </tr>
              <% }) %> <% } %>
            </tbody>
          </table>

          <div class="carrello-totale">
            <h3>Totale: ‚Ç¨<%= Number(totale).toFixed(2) %></h3>

            <% if (carrello.length> 0) { %>
            <form
              id="svuotaCarrelloForm"
              method="POST"
              action="/carrello/svuota"
            >
              <button
                id="svuotaCarrelloBtn"
                class="btn btn-secondary"
                type="submit"
              >
                Svuota carrello
              </button>
            </form>

            <form method="POST" action="/carrello/checkout">
              <button class="btn">Procedi al Pagamento</button>
            </form>
            <% } else { %>
            <a class="btn disabled-link">Procedi al Pagamento</a>
            <% } %>
          </div>
        </div>
      </section>
    </section>

    <%- include('partials/footer') %>

    <!-- AOS Script-->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <!--Script.js-->
    <script src="/js/script.js"></script>
  </body>
</html>
